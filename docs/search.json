[
  {
    "objectID": "Lab8.html",
    "href": "Lab8.html",
    "title": "Lab 8: Machine Learning The Whole Game Plan",
    "section": "",
    "text": "Load in necessary packages\n\nlibrary(tidyverse)\n\nWarning: package 'lubridate' was built under R version 4.4.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tidymodels)\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──\n✔ broom        1.0.7     ✔ rsample      1.2.1\n✔ dials        1.3.0     ✔ tune         1.2.1\n✔ infer        1.0.7     ✔ workflows    1.1.4\n✔ modeldata    1.4.0     ✔ workflowsets 1.1.0\n✔ parsnip      1.2.1     ✔ yardstick    1.3.2\n✔ recipes      1.1.1     \n\n\nWarning: package 'recipes' was built under R version 4.4.3\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n• Dig deeper into tidy modeling with R at https://www.tmwr.org\n\nlibrary(powerjoin)\n\nWarning: package 'powerjoin' was built under R version 4.4.3\n\nlibrary(glue)\nlibrary(vip)\n\nWarning: package 'vip' was built under R version 4.4.3\n\n\n\nAttaching package: 'vip'\n\nThe following object is masked from 'package:utils':\n\n    vi\n\nlibrary(baguette)\n\nWarning: package 'baguette' was built under R version 4.4.3\n\nlibrary(ggplot2)\nlibrary(ggpubr)\n\nWarning: package 'ggpubr' was built under R version 4.4.3\n\nlibrary(dplyr)\nlibrary(visdat)\nlibrary (powerjoin)\n\n\n\nRead in CAMELS data\n\n# Read in Data from CAMELS data set\n\nroot  &lt;- 'https://gdex.ucar.edu/dataset/camels/file'\n\n# Documentation PDF \ndownload.file('https://gdex.ucar.edu/dataset/camels/file/camels_attributes_v2.0.pdf', 'data/camels_attributes_v2.0.pdf')\n\n# Vector storing data types/files\ntypes &lt;- c(\"clim\", \"geol\", \"soil\", \"topo\", \"vege\", \"hydro\")\n\n# Where the files live online ...\nremote_files  &lt;- glue('{root}/camels_{types}.txt')\n\n# Where we want to download the data ...\nlocal_files   &lt;- glue('data/camels_{types}.txt')\n\n# Download more data\n\nwalk2(remote_files, local_files, download.file, quiet = TRUE)\n\n# Read and merge data\n\ncamels &lt;- map(local_files, read_delim, show_col_types = FALSE) \n\n# Full join of data\n\ncamels &lt;- power_full_join(camels ,by = 'gauge_id')\n\n\n\nClean Data\n\n# Summary data \nsummary(camels)\n\n   gauge_id             p_mean          pet_mean     p_seasonality     \n Length:671         Min.   :0.6446   Min.   :1.899   Min.   :-1.43546  \n Class :character   1st Qu.:2.3731   1st Qu.:2.335   1st Qu.:-0.26352  \n Mode  :character   Median :3.2295   Median :2.688   Median : 0.08093  \n                    Mean   :3.2577   Mean   :2.787   Mean   :-0.04128  \n                    3rd Qu.:3.7835   3rd Qu.:3.146   3rd Qu.: 0.22399  \n                    Max.   :8.9369   Max.   :4.744   Max.   : 0.92202  \n                                                                       \n   frac_snow          aridity       high_prec_freq  high_prec_dur  \n Min.   :0.00000   Min.   :0.2203   Min.   : 7.90   Min.   :1.075  \n 1st Qu.:0.03514   1st Qu.:0.6957   1st Qu.:18.50   1st Qu.:1.209  \n Median :0.09793   Median :0.8551   Median :22.00   Median :1.282  \n Mean   :0.17760   Mean   :1.0565   Mean   :20.93   Mean   :1.350  \n 3rd Qu.:0.22306   3rd Qu.:1.2673   3rd Qu.:24.23   3rd Qu.:1.440  \n Max.   :0.90633   Max.   :5.2079   Max.   :32.70   Max.   :2.091  \n                                                                   \n high_prec_timing   low_prec_freq    low_prec_dur    low_prec_timing   \n Length:671         Min.   :169.9   Min.   : 2.789   Length:671        \n Class :character   1st Qu.:232.7   1st Qu.: 4.241   Class :character  \n Mode  :character   Median :255.8   Median : 4.950   Mode  :character  \n                    Mean   :254.6   Mean   : 5.954                     \n                    3rd Qu.:278.9   3rd Qu.: 6.702                     \n                    Max.   :348.7   Max.   :36.513                     \n                                                                       \n geol_1st_class     glim_1st_class_frac geol_2nd_class     glim_2nd_class_frac\n Length:671         Min.   :0.2967      Length:671         Min.   :0.000000   \n Class :character   1st Qu.:0.6083      Class :character   1st Qu.:0.002894   \n Mode  :character   Median :0.8294      Mode  :character   Median :0.136540   \n                    Mean   :0.7855                         Mean   :0.155426   \n                    3rd Qu.:0.9971                         3rd Qu.:0.266373   \n                    Max.   :1.0000                         Max.   :0.489930   \n                                                                              \n carbonate_rocks_frac geol_porostiy     geol_permeability soil_depth_pelletier\n Min.   :0.00000      Min.   :0.01000   Min.   :-16.50    Min.   : 0.2667     \n 1st Qu.:0.00000      1st Qu.:0.06767   1st Qu.:-14.77    1st Qu.: 1.0000     \n Median :0.00000      Median :0.13190   Median :-13.96    Median : 1.2283     \n Mean   :0.11874      Mean   :0.12637   Mean   :-13.89    Mean   :10.8728     \n 3rd Qu.:0.04333      3rd Qu.:0.18623   3rd Qu.:-13.00    3rd Qu.:12.8894     \n Max.   :1.00000      Max.   :0.28000   Max.   :-10.90    Max.   :50.0000     \n                      NA's   :3                                               \n soil_depth_statsgo soil_porosity    soil_conductivity max_water_content\n Min.   :0.3999     Min.   :0.3733   Min.   : 0.4469   Min.   :0.0866   \n 1st Qu.:1.1054     1st Qu.:0.4309   1st Qu.: 0.9321   1st Qu.:0.4293   \n Median :1.4577     Median :0.4422   Median : 1.3477   Median :0.5579   \n Mean   :1.2932     Mean   :0.4426   Mean   : 1.7405   Mean   :0.5280   \n 3rd Qu.:1.5000     3rd Qu.:0.4554   3rd Qu.: 1.9323   3rd Qu.:0.6450   \n Max.   :1.5000     Max.   :0.6800   Max.   :13.9557   Max.   :1.0520   \n                                                                        \n   sand_frac        silt_frac        clay_frac        water_frac     \n Min.   : 8.184   Min.   : 2.985   Min.   : 1.846   Min.   : 0.0000  \n 1st Qu.:25.437   1st Qu.:23.947   1st Qu.:13.999   1st Qu.: 0.0000  \n Median :35.269   Median :34.059   Median :18.663   Median : 0.0000  \n Mean   :36.468   Mean   :33.859   Mean   :19.886   Mean   : 0.1017  \n 3rd Qu.:44.457   3rd Qu.:43.639   3rd Qu.:25.420   3rd Qu.: 0.0000  \n Max.   :91.976   Max.   :67.775   Max.   :50.354   Max.   :19.3545  \n                                                                     \n  organic_frac       other_frac       gauge_lat       gauge_lon      \n Min.   : 0.0000   Min.   : 0.000   Min.   :27.05   Min.   :-124.39  \n 1st Qu.: 0.0000   1st Qu.: 0.000   1st Qu.:35.70   1st Qu.:-110.41  \n Median : 0.0000   Median : 1.309   Median :39.25   Median : -92.78  \n Mean   : 0.5918   Mean   : 9.825   Mean   :39.24   Mean   : -95.79  \n 3rd Qu.: 0.0000   3rd Qu.:11.737   3rd Qu.:43.21   3rd Qu.: -81.77  \n Max.   :57.8631   Max.   :99.378   Max.   :48.82   Max.   : -67.94  \n                                                                     \n   elev_mean         slope_mean        area_gages2       area_geospa_fabric\n Min.   :  10.21   Min.   :  0.8222   Min.   :    4.03   Min.   :    4.1   \n 1st Qu.: 249.67   1st Qu.:  7.4268   1st Qu.:  122.28   1st Qu.:  128.0   \n Median : 462.72   Median : 28.8016   Median :  329.68   Median :  340.7   \n Mean   : 759.42   Mean   : 46.1953   Mean   :  792.62   Mean   :  808.1   \n 3rd Qu.: 928.88   3rd Qu.: 73.1695   3rd Qu.:  794.29   3rd Qu.:  804.5   \n Max.   :3571.18   Max.   :255.6884   Max.   :25791.04   Max.   :25817.8   \n                                                                           \n  frac_forest        lai_max          lai_diff         gvf_max      \n Min.   :0.0000   Min.   :0.3671   Min.   :0.1544   Min.   :0.1843  \n 1st Qu.:0.2771   1st Qu.:1.8143   1st Qu.:1.1968   1st Qu.:0.6086  \n Median :0.8137   Median :3.3713   Median :2.3365   Median :0.7803  \n Mean   :0.6395   Mean   :3.2160   Mean   :2.4486   Mean   :0.7221  \n 3rd Qu.:0.9724   3rd Qu.:4.6963   3rd Qu.:3.7574   3rd Qu.:0.8649  \n Max.   :1.0000   Max.   :5.5821   Max.   :4.8315   Max.   :0.9157  \n                                                                    \n    gvf_diff      dom_land_cover_frac dom_land_cover     root_depth_50   \n Min.   :0.0290   Min.   :0.3145      Length:671         Min.   :0.1200  \n 1st Qu.:0.1883   1st Qu.:0.6511      Class :character   1st Qu.:0.1654  \n Median :0.3160   Median :0.8582      Mode  :character   Median :0.1800  \n Mean   :0.3227   Mean   :0.8100                         Mean   :0.1788  \n 3rd Qu.:0.4627   3rd Qu.:0.9967                         3rd Qu.:0.1900  \n Max.   :0.6522   Max.   :1.0000                         Max.   :0.2500  \n                                                         NA's   :24      \n root_depth_99       q_mean          runoff_ratio        slope_fdc     \n Min.   :1.500   Min.   :0.004553   Min.   :0.004238   Min.   :0.0000  \n 1st Qu.:1.522   1st Qu.:0.632918   1st Qu.:0.242443   1st Qu.:0.8978  \n Median :1.800   Median :1.131818   Median :0.350664   Median :1.2829  \n Mean   :1.830   Mean   :1.493967   Mean   :0.387146   Mean   :1.2372  \n 3rd Qu.:2.000   3rd Qu.:1.750901   3rd Qu.:0.506681   3rd Qu.:1.6306  \n Max.   :3.100   Max.   :9.688438   Max.   :1.362132   Max.   :2.4973  \n NA's   :24      NA's   :1          NA's   :1          NA's   :1       \n baseflow_index      stream_elas            q5                q95        \n Min.   :0.006858   Min.   :-0.6363   Min.   :0.000000   Min.   : 0.000  \n 1st Qu.:0.397430   1st Qu.: 1.3177   1st Qu.:0.009155   1st Qu.: 2.066  \n Median :0.504923   Median : 1.7006   Median :0.081568   Median : 3.769  \n Mean   :0.491447   Mean   : 1.8322   Mean   :0.171803   Mean   : 5.057  \n 3rd Qu.:0.600345   3rd Qu.: 2.2255   3rd Qu.:0.219522   3rd Qu.: 6.288  \n Max.   :0.977556   Max.   : 6.2405   Max.   :2.424938   Max.   :31.817  \n                    NA's   :1         NA's   :1          NA's   :1       \n  high_q_freq        high_q_dur       low_q_freq       low_q_dur     \n Min.   :  0.000   Min.   : 0.000   Min.   :  0.00   Min.   :  0.00  \n 1st Qu.:  6.412   1st Qu.: 1.821   1st Qu.: 37.44   1st Qu.: 10.00  \n Median : 15.100   Median : 2.848   Median : 96.00   Median : 15.52  \n Mean   : 25.745   Mean   : 6.913   Mean   :107.62   Mean   : 22.28  \n 3rd Qu.: 35.788   3rd Qu.: 7.554   3rd Qu.:162.14   3rd Qu.: 26.91  \n Max.   :172.800   Max.   :92.559   Max.   :356.80   Max.   :209.88  \n NA's   :1         NA's   :1        NA's   :1        NA's   :1       \n  zero_q_freq         hfd_mean    \n Min.   :0.00000   Min.   :112.2  \n 1st Qu.:0.00000   1st Qu.:160.2  \n Median :0.00000   Median :173.8  \n Mean   :0.03415   Mean   :182.5  \n 3rd Qu.:0.00000   3rd Qu.:204.1  \n Max.   :0.96537   Max.   :287.8  \n NA's   :1         NA's   :1      \n\nls(camels)\n\n [1] \"area_gages2\"          \"area_geospa_fabric\"   \"aridity\"             \n [4] \"baseflow_index\"       \"carbonate_rocks_frac\" \"clay_frac\"           \n [7] \"dom_land_cover\"       \"dom_land_cover_frac\"  \"elev_mean\"           \n[10] \"frac_forest\"          \"frac_snow\"            \"gauge_id\"            \n[13] \"gauge_lat\"            \"gauge_lon\"            \"geol_1st_class\"      \n[16] \"geol_2nd_class\"       \"geol_permeability\"    \"geol_porostiy\"       \n[19] \"glim_1st_class_frac\"  \"glim_2nd_class_frac\"  \"gvf_diff\"            \n[22] \"gvf_max\"              \"hfd_mean\"             \"high_prec_dur\"       \n[25] \"high_prec_freq\"       \"high_prec_timing\"     \"high_q_dur\"          \n[28] \"high_q_freq\"          \"lai_diff\"             \"lai_max\"             \n[31] \"low_prec_dur\"         \"low_prec_freq\"        \"low_prec_timing\"     \n[34] \"low_q_dur\"            \"low_q_freq\"           \"max_water_content\"   \n[37] \"organic_frac\"         \"other_frac\"           \"p_mean\"              \n[40] \"p_seasonality\"        \"pet_mean\"             \"q_mean\"              \n[43] \"q5\"                   \"q95\"                  \"root_depth_50\"       \n[46] \"root_depth_99\"        \"runoff_ratio\"         \"sand_frac\"           \n[49] \"silt_frac\"            \"slope_fdc\"            \"slope_mean\"          \n[52] \"soil_conductivity\"    \"soil_depth_pelletier\" \"soil_depth_statsgo\"  \n[55] \"soil_porosity\"        \"stream_elas\"          \"water_frac\"          \n[58] \"zero_q_freq\"         \n\n# Data cleaning\ncamels &lt;- na.omit(camels)\n\n\n\nExploratory Visual Data Analysis\n\n# Map of q mean of the sites\n\nggplot(data = camels, aes(x = gauge_lon, y = gauge_lat)) +\n  borders(\"state\", colour = \"gray50\") +\n  geom_point(aes(color = q_mean)) +\n  scale_color_gradient(low = \"lightblue\", high = \"darkblue\") +\n  ggthemes::theme_map()\n\n\n\n\n\n\n\n# Create a scatter plot of aridity vs rainfall\n\nggplot(camels, aes(x = aridity, y = p_mean)) +\n  # Add points colored by mean flow\n  geom_point(aes(color = q_mean)) +\n  # Add a linear regression line\n  geom_smooth(method = \"lm\", color = \"red\", linetype = 2) +\n  # Apply the viridis color scale\n  scale_color_viridis_c() +\n  # Add a title, axis labels, and theme (w/ legend on the bottom)\n  theme_linedraw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Aridity vs Rainfall vs Runnoff\", \n       x = \"Aridity\", \n       y = \"Rainfall\",\n       color = \"Mean Flow\")\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n# Test transformation \n\nggplot(camels, aes(x = aridity, y = p_mean)) +\n  geom_point(aes(color = q_mean)) +\n  geom_smooth(method = \"lm\") +\n  scale_color_viridis_c() +\n  # Apply log transformations to the x and y axes\n  scale_x_log10() + \n  scale_y_log10() +\n  theme_linedraw() +\n  theme(legend.position = \"bottom\") + \n  labs(title = \"Aridity vs Rainfall vs Runnoff\", \n       x = \"Aridity\", \n       y = \"Rainfall\",\n       color = \"Mean Flow\")\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n# Visualize log transform may benefit q_mean data \n\nggplot(camels, aes(x = aridity, y = p_mean)) +\n  geom_point(aes(color = q_mean)) +\n  geom_smooth(method = \"lm\") +\n  # Apply a log transformation to the color scale\n  scale_color_viridis_c(trans = \"log\") +\n  scale_x_log10() + \n  scale_y_log10() +\n  theme_linedraw() +\n  theme(legend.position = \"bottom\",\n        # Expand the legend width ...\n        legend.key.width = unit(2.5, \"cm\"),\n        legend.key.height = unit(.5, \"cm\")) + \n  labs(title = \"Aridity vs Rainfall vs Runnoff\", \n       x = \"Aridity\", \n       y = \"Rainfall\",\n       color = \"Mean Flow\") \n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\nData Spliting\n\n# Start by splitting the data \n\nset.seed(123)\n\n# Bad form to perform simple transformations on the outcome variable within a recipe. So, we'll do it here.\n\ncamels &lt;- camels |&gt; \n  mutate(logQmean = log(q_mean))\n\n# Generate the split\n\ncamels_split &lt;- initial_split(camels, prop = 0.8)\ncamels_train &lt;- training(camels_split)\ncamels_test  &lt;- testing(camels_split)\n\n\n\nFeature Engineering\n\n# Create a recipe to preprocess the data\n\nrec &lt;-  recipe(logQmean ~ aridity + p_mean, data = camels_train) %&gt;%\n  # Log transform the predictor variables (aridity and p_mean)\n  step_log(all_predictors()) %&gt;%\n  # Add an interaction term between aridity and p_mean\n  step_interact(terms = ~ aridity:p_mean) |&gt; \n  # Drop any rows with missing values in the pred\n  step_naomit(all_predictors(), all_outcomes())\n\n\n\nResampling and Model Testing\n\n# Build re-samples\n\ncamels_cv &lt;- vfold_cv(camels_train, v = 10)\n\n# Define Three Regression Models  \n\nrf_model &lt;- rand_forest() |&gt; \n  set_engine(\"ranger\") |&gt; \n  set_mode(\"regression\")\n\nxgbm_model &lt;- boost_tree() |&gt; \n  set_engine(\"xgboost\") |&gt; \n  set_mode(\"regression\")\n\nNeuralNet_Model &lt;- bag_mlp () |&gt;\n  set_engine(\"nnet\") |&gt;\n  set_mode(\"regression\")\n\n# Workflow Set/Map/Auto-plot\n\nwf &lt;- workflow_set(list(rec), list(rf_model, xgbm_model, NeuralNet_Model)) %&gt;% \n  workflow_map(resamples = camels_cv,\n               metrics   = metric_set(mae, rsq, rmse))\n\nWarning: package 'ranger' was built under R version 4.4.3\n\n\nWarning: package 'xgboost' was built under R version 4.4.3\n\nautoplot(wf)\n\n\n\n\n\n\n\nrank_results(wf, rank_metric = \"rsq\", select_best = TRUE)\n\n# A tibble: 9 × 9\n  wflow_id          .config .metric  mean std_err     n preprocessor model  rank\n  &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;int&gt;\n1 recipe_bag_mlp    Prepro… mae     0.377  0.0191    10 recipe       bag_…     1\n2 recipe_bag_mlp    Prepro… rmse    0.575  0.0317    10 recipe       bag_…     1\n3 recipe_bag_mlp    Prepro… rsq     0.778  0.0262    10 recipe       bag_…     1\n4 recipe_rand_fore… Prepro… mae     0.395  0.0193    10 recipe       rand…     2\n5 recipe_rand_fore… Prepro… rmse    0.594  0.0324    10 recipe       rand…     2\n6 recipe_rand_fore… Prepro… rsq     0.762  0.0285    10 recipe       rand…     2\n7 recipe_boost_tree Prepro… mae     0.420  0.0152    10 recipe       boos…     3\n8 recipe_boost_tree Prepro… rmse    0.645  0.0238    10 recipe       boos…     3\n9 recipe_boost_tree Prepro… rsq     0.728  0.0203    10 recipe       boos…     3\n\n# Model Selection with Justification \n\n# Out of the three models, the one that I am going to select that performed the best is the Random Forest model that's set with the ranger engine and regression mode. In our workflow rank it shows that this model had the lowest scores in the mae and rmse but the highest rsq closest to 1 which shows that this model is the best to represent our camels data and predict logQmean accurately since it's overall a simplistic model with high predicitve acccuracy.\n\n\n\nModel Tuning\n\n# Define a tunable model \n\nrf_tune &lt;- rand_forest(trees = tune(), min_n = tune()) |&gt; \n  set_engine(\"ranger\") |&gt; \n  set_mode(\"regression\")\n\n# Create a workflow\n\nwf_tune &lt;- workflow(rec, \n                    rand_forest(mode       = \"regression\", \n                               engine     = \"ranger\", \n                               trees      = tune(), \n                               min_n      = tune()))\n\nwf_tune = workflow() |&gt;\n  add_recipe(rec) |&gt;\n  add_model(rf_tune)\n\n# Check the Tunable Values/Ranges\n\ndials &lt;- extract_parameter_set_dials(wf_tune) \ndials$object\n\n[[1]]\n# Trees (quantitative)\nRange: [1, 2000]\n\n[[2]]\nMinimal Node Size (quantitative)\nRange: [2, 40]\n\n# Define Search Space (SFD with 25 predefined combos)\n\nmy.grid &lt;- dials |&gt; \n  update(trees = trees(c(1, 2000))) |&gt;\n  grid_space_filling(size = 25)\n\n# Tune the Model \n\nmodel_params &lt;-  tune_grid(\n    wf_tune,\n    resamples = camels_cv,\n    grid = my.grid,\n    metrics = metric_set(rmse, rsq, mae),\n    control = control_grid(save_pred = TRUE)\n  )\n\nautoplot(model_params)\n\n\n\n\n\n\n\n# Describe what you see !\n\n# Minimal node size seem to have a similar relationship in relation to mae and rmse where as they increase the metrics decrease but with the metric rsq they all increase together. The trees seem to have no relationship with the metrics. \n\n\n\nCheck the skill of the tuned model\n\n# Check using collect_metric () function\n\ntree_metrics = metric_set(rsq, rmse, mae)\n\nhp_best &lt;- select_best(model_params, metric = \"mae\")\n\nfinalize &lt;- finalize_workflow(wf_tune, hp_best)\n\nfinal_fit &lt;- last_fit(finalize, camels_split, metrics = tree_metrics)\n\ncollect_metrics(final_fit)\n\n# A tibble: 3 × 4\n  .metric .estimator .estimate .config             \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               \n1 rsq     standard       0.801 Preprocessor1_Model1\n2 rmse    standard       0.615 Preprocessor1_Model1\n3 mae     standard       0.341 Preprocessor1_Model1\n\n# Using this function, I can see from the tibble it produced that all metrics are standard with rsq being the highest at 0.78 and mae being the lowest at 0.33 which is goof for our model. \n\n\n# Check using the show_best() function\n\nshow_best(model_params, metric = \"mae\")\n\n# A tibble: 5 × 8\n  trees min_n .metric .estimator  mean     n std_err .config              \n  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                \n1   750    21 mae     standard   0.380    10  0.0180 Preprocessor1_Model10\n2   833    30 mae     standard   0.381    10  0.0173 Preprocessor1_Model11\n3   417    27 mae     standard   0.381    10  0.0176 Preprocessor1_Model06\n4  1167    25 mae     standard   0.381    10  0.0180 Preprocessor1_Model15\n5  1583    28 mae     standard   0.381    10  0.0173 Preprocessor1_Model20\n\n# From this function we are able to see that the top five performing models have different amounts of trees and min_n that bring in a mean of 0.31. \n\n# Use the select_best() function to save the best hp\n\nhp_best &lt;- select_best(model_params, metric = \"mae\")\n\n\n\nFinalize your model\n\n# Use the Finalize_Workflow () function \n\nfinalize &lt;- finalize_workflow(wf_tune, hp_best)\n\n\n\nFinal Model Verification\n\n# Use last_fit() to finalize workflow\n\nfinal_fit &lt;- last_fit(finalize, camels_split, metrics = tree_metrics)\n\n# Interpret the Metrics\n\ncollect_metrics(final_fit)\n\n# A tibble: 3 × 4\n  .metric .estimator .estimate .config             \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               \n1 rsq     standard       0.803 Preprocessor1_Model1\n2 rmse    standard       0.614 Preprocessor1_Model1\n3 mae     standard       0.341 Preprocessor1_Model1\n\n # How does the final model perform on the test data? Is it better or worse than the training data? Use your knowledge of the regression based metrics to describe the results.\n# The final model performs similarly to how our random forest model performed with the metrics in standard form of rsq, rmse, and mae, which means it performed well with the test data. The rsq values being similar on both data sets shows a high correlation for both applications of the model. The mae and rmse were almost exactly the same on both data sets which shows it performed well since the error scores were relatively low. \n\n\n# Plot Predictions\n\ncollect_predictions(final_fit) |&gt; \n  ggplot(aes(x = .pred, y = logQmean)) + \n  geom_point(color = \"blue\") +\n  geom_abline(color = \"red\") + \n  geom_smooth(method = \"lm\", color = \"darkblue\") + \n  theme_linedraw() + \n  labs(title = \"Final Fit\", \n       x = \"Predicted (LogQ10)\", \n       y = \"Actual (LogQ10)\")\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\nBuilding a Map!\n\n# Use the augment() function for predictions\n\npred = fit(finalize, data = camels) |&gt;\n  augment(new_data = camels) \n\n# Use the mutate() function to get the residuals \n\nresid &lt;- pred |&gt;\n  mutate(residuals=(.pred-logQmean)^2)\n\n# Map of Predictions \n\nggplot(pred, aes(x = logQmean, y = .pred)) + \n  geom_point(color = \"#2c7fb8\", alpha = 0.7) + \n  geom_abline(color = \"brown\", linetype = \"dashed\") +\n  geom_smooth(method = \"lm\", color = \"#253494\", fill = \"#253494\", alpha = 0.2) + \n  labs(title = \"Random Forest Model\", \n       x = \"Actual (LogQ10)\", \n       y = \"Predicted (LogQ10)\", subtitle = ) + \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n# Map of Residuals \n\nggplot(resid, aes(x = logQmean, y = residuals)) + \n  geom_point(color = \"#1b9e77\", alpha = 0.7) + \n  geom_abline(color = \"purple\", linetype = \"dashed\") +\n  geom_smooth(method = \"lm\", color = \"#d95f02\", fill = \"orange\", alpha = 0.2) + \n  labs(title = \"Random Forest Model - Residuals\", \n       x = \"Actual (LogQ10)\", \n       y = \"Predicted (LogQ10)\", subtitle = ) + \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n# Combine both maps into ONE figure\n\nplot1 &lt;- ggplot(pred, aes(x = logQmean, y = .pred)) + \n  geom_point(color = \"#2c7fb8\", alpha = 0.7) + \n  geom_abline(color = \"purple\", linetype = \"dashed\") +\n  geom_smooth(method = \"lm\", color = \"#d95f02\", fill = \"orange\", alpha = 0.2) + \n  labs(title = \"Random Forest Model - Predicted Q\", \n       x = \"Actual (LogQ10)\", \n       y = \"Predicted (LogQ10)\", subtitle = ) + \n  theme_minimal()\n\nplot2 &lt;- ggplot(resid, aes(x = logQmean, y = residuals)) +\n  geom_point(color = \"#1b9e77\", alpha = 0.7) + \n  geom_abline(color = \"purple\", linetype = \"dashed\") +\n  geom_smooth(method = \"lm\", color = \"#d95f02\", fill = \"orange\", alpha = 0.2) + \n  labs(title = \"Random Forest Model - Residuals\", \n       x = \"Actual (LogQ10)\", \n       y = \"Predicted (LogQ10)\", subtitle = ) + \n  theme_minimal()\n\nggarrange(plot1, plot2, ncol = 2)\n\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'"
  }
]